--- components/chat.tsx
+++ components/chat.tsx
@@ -40,6 +40,7 @@
   const [isSubmitting, setIsSubmitting] = useState(false)
   const [suggestions, setSuggestions] = useState<PartialRelated | null>(null)
   const chatPanelRef = useRef<ChatPanelRef>(null);
+  const lastRefreshedMessageIdRef = useRef<string | null>(null)

   const handleAttachment = () => {
     chatPanelRef.current?.handleAttachmentClick();
@@ -76,10 +77,15 @@
   }, [id, path, messages])

   useEffect(() => {
-    if (aiState.messages[aiState.messages.length - 1]?.type === 'response') {
-      // Refresh the page to chat history updates
+    // Find the last message of type 'response'
+    const responseMessage = [...aiState.messages]
+      .reverse()
+      .find(m => m.type === 'response')
+
+    if (responseMessage && responseMessage.id !== lastRefreshedMessageIdRef.current) {
+      // Refresh the page to update chat history in the sidebar
+      lastRefreshedMessageIdRef.current = responseMessage.id
       router.refresh()
     }
   }, [aiState, router])
